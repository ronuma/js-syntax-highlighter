<!DOCTYPE html>
  <html lang="en">
    <head>
      <meta charset="UTF-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="stylesheet" href="styles.css" />
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
      <title>JS Syntax Highlighter</title></head><body><pre>
<span class="comment">// Example file of a helper module for a node.js app</span><br><br><span class="keyword">import</span><span class="space"> </span><span class="special">{</span><span class="var">db</span><span class="special">}</span><span class="space"> </span><span class="var">from</span><span class="space"> </span><span class="string">"../firebaseConfig.js"</span><br><span class="keyword">import</span><span class="space"> </span><span class="special">{</span><span class="var">instruments</span><span class="special">}</span><span class="space"> </span><span class="var">from</span><span class="space"> </span><span class="string">"../constants.js"</span><br><span class="keyword">import</span><span class="space"> </span><span class="special">{</span><span class="var">getDownloadUrl</span><span class="punctuation">,</span><span class="space"> </span><span class="var">getDownloadUrls</span><span class="special">}</span><span class="space"> </span><span class="var">from</span><span class="space"> </span><span class="string">"../utils.js"</span><br><br><span class="var">async</span><span class="space"> </span><span class="keyword">function</span><span class="space"> </span><span class="special">getSchools(</span><span class="var">instrumentIds</span><span class="punctuation">,</span><span class="space"> </span><span class="var">userId</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">   </span><span class="keyword">const</span><span class="space"> </span><span class="var">collectionRef</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="number">db</span><span class="punctuation">.</span><span class="special">collection(</span><span class="string">"schools"</span><span class="special">)</span><br><span class="space">   </span><span class="keyword">let</span><span class="space"> </span><span class="var">data</span><br><span class="space">   </span><span class="keyword">if</span><span class="space"> </span><span class="special">(</span><span class="var">instrumentIds</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">      </span><span class="keyword">const</span><span class="space"> </span><span class="var">instruments</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="number">instrumentIds</span><span class="punctuation">.</span><span class="special">split(</span><span class="string">","</span><span class="special">)</span><br><span class="space">      </span><span class="var">data</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="keyword">await</span><span class="space"> </span><span class="var">collectionRef</span><br><span class="space">         </span><span class="punctuation">.</span><span class="special">where(</span><span class="string">"lessons"</span><span class="punctuation">,</span><span class="space"> </span><span class="string">"array-contains-any"</span><span class="punctuation">,</span><span class="space"> </span><span class="var">instruments</span><span class="special">)</span><br><span class="space">         </span><span class="punctuation">.</span><span class="special">get(</span><span class="special">)</span><br><span class="space">   </span><span class="special">}</span><span class="space"> </span><span class="keyword">else</span><span class="space"> </span><span class="special">{</span><br><span class="space">      </span><span class="var">data</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="keyword">await</span><span class="space"> </span><span class="number">collectionRef</span><span class="punctuation">.</span><span class="special">get(</span><span class="special">)</span><br><span class="space">   </span><span class="special">}</span><br><span class="space">   </span><span class="keyword">if</span><span class="space"> </span><span class="special">(</span><span class="number">data</span><span class="punctuation">.</span><span class="var">empty</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">      </span><span class="keyword">return</span><span class="space"> </span><span class="boolean">null</span><br><span class="space">   </span><span class="special">}</span><br><span class="space">   </span><span class="keyword">const</span><span class="space"> </span><span class="var">schools</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="special">[</span><span class="special">]</span><br><span class="space">   </span><span class="keyword">for</span><span class="space"> </span><span class="special">(</span><span class="keyword">const</span><span class="space"> </span><span class="var">index</span><span class="space"> </span><span class="keyword">in</span><span class="space"> </span><span class="number">data</span><span class="punctuation">.</span><span class="var">docs</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">      </span><span class="keyword">const</span><span class="space"> </span><span class="var">school</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="keyword">await</span><span class="space"> </span><span class="special">formatSchool(</span><span class="number">data</span><span class="punctuation">.</span><span class="var">docs</span><span class="special">[</span><span class="var">index</span><span class="special">]</span><span class="punctuation">,</span><span class="space"> </span><span class="var">userId</span><span class="special">)</span><br><span class="space">      </span><span class="number">schools</span><span class="punctuation">.</span><span class="special">push(</span><span class="var">school</span><span class="special">)</span><br><span class="space">   </span><span class="special">}</span><br><span class="space">   </span><span class="keyword">return</span><span class="space"> </span><span class="var">schools</span><br><span class="special">}</span><br><br><span class="var">async</span><span class="space"> </span><span class="keyword">function</span><span class="space"> </span><span class="special">getSchoolById(</span><span class="var">id</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">   </span><span class="keyword">const</span><span class="space"> </span><span class="var">data</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="keyword">await</span><span class="space"> </span><span class="number">db</span><span class="punctuation">.</span><span class="special">collection(</span><span class="string">"schools"</span><span class="special">)</span><span class="punctuation">.</span><span class="special">doc(</span><span class="var">id</span><span class="special">)</span><span class="punctuation">.</span><span class="special">get(</span><span class="special">)</span><br><span class="space">   </span><span class="keyword">if</span><span class="space"> </span><span class="special">(</span><span class="number">data</span><span class="punctuation">.</span><span class="var">empty</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">      </span><span class="keyword">return</span><span class="space"> </span><span class="boolean">null</span><br><span class="space">   </span><span class="special">}</span><br><span class="space">   </span><span class="keyword">const</span><span class="space"> </span><span class="var">school</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="keyword">await</span><span class="space"> </span><span class="special">formatSchool(</span><span class="var">data</span><span class="special">)</span><br><span class="space">   </span><span class="keyword">return</span><span class="space"> </span><span class="var">school</span><br><span class="special">}</span><br><br><span class="comment">// ---- funcion auxiliar para formatear escuela ----</span><br><br><span class="var">async</span><span class="space"> </span><span class="keyword">function</span><span class="space"> </span><span class="special">formatSchool(</span><span class="var">school</span><span class="punctuation">,</span><span class="space"> </span><span class="var">userId</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">   </span><span class="keyword">const</span><span class="space"> </span><span class="var">schoolInstruments</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="special">[</span><span class="special">]</span><br><span class="space">   </span><span class="keyword">for</span><span class="space"> </span><span class="special">(</span><span class="keyword">const</span><span class="space"> </span><span class="var">index</span><span class="space"> </span><span class="keyword">in</span><span class="space"> </span><span class="number">school</span><span class="punctuation">.</span><span class="special">data(</span><span class="special">)</span><span class="punctuation">.</span><span class="var">lessons</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">      </span><span class="keyword">const</span><span class="space"> </span><span class="var">instrument</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="number">instruments</span><span class="punctuation">.</span><span class="special">find(</span><br><span class="space">         </span><span class="var">instrument</span><span class="space"> </span><span class="boolean">=</span><span class="boolean">></span><span class="space"> </span><span class="number">instrument</span><span class="punctuation">.</span><span class="var">id</span><span class="space"> </span><span class="boolean">=</span><span class="boolean">=</span><span class="space"> </span><span class="number">school</span><span class="punctuation">.</span><span class="special">data(</span><span class="special">)</span><span class="punctuation">.</span><span class="var">lessons</span><span class="special">[</span><span class="var">index</span><span class="special">]</span><br><span class="space">      </span><span class="special">)</span><br><span class="space">      </span><span class="number">schoolInstruments</span><span class="punctuation">.</span><span class="special">push(</span><span class="var">instrument</span><span class="special">)</span><br><span class="space">   </span><span class="special">}</span><br><span class="space">   </span><span class="number">schoolInstruments</span><span class="punctuation">.</span><span class="special">sort(</span><span class="special">(</span><span class="var">a</span><span class="punctuation">,</span><span class="space"> </span><span class="var">b</span><span class="special">)</span><span class="space"> </span><span class="boolean">=</span><span class="boolean">></span><span class="space"> </span><span class="number">a</span><span class="punctuation">.</span><span class="number">name</span><span class="punctuation">.</span><span class="special">localeCompare(</span><span class="number">b</span><span class="punctuation">.</span><span class="var">name</span><span class="special">)</span><span class="special">)</span><br><span class="space">   </span><span class="comment">// check if the school is saved by the user</span><br><span class="space">   </span><span class="keyword">let</span><span class="space"> </span><span class="var">isSaved</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="boolean">false</span><br><span class="space">   </span><span class="keyword">if</span><span class="space"> </span><span class="special">(</span><span class="var">userId</span><span class="special">)</span><span class="space"> </span><span class="special">{</span><br><span class="space">      </span><span class="var">isSaved</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="number">school</span><span class="punctuation">.</span><span class="special">data(</span><span class="special">)</span><span class="punctuation">.</span><span class="number">savedBy</span><span class="punctuation">.</span><span class="special">includes(</span><span class="var">userId</span><span class="special">)</span><br><span class="space">   </span><span class="special">}</span><br><span class="space">   </span><span class="keyword">const</span><span class="space"> </span><span class="var">data</span><span class="space"> </span><span class="boolean">=</span><span class="space"> </span><span class="special">{</span><br><span class="space">      </span><span class="punctuation">id:</span><span class="space"> </span><span class="number">school</span><span class="punctuation">.</span><span class="var">id</span><span class="punctuation">,</span><br><span class="space">      </span><span class="punctuation">.</span><span class="punctuation">.</span><span class="punctuation">.</span><span class="number">school</span><span class="punctuation">.</span><span class="special">data(</span><span class="special">)</span><span class="punctuation">,</span><br><span class="space">      </span><span class="punctuation">lessons:</span><span class="space"> </span><span class="var">schoolInstruments</span><span class="punctuation">,</span><br><span class="space">      </span><span class="punctuation">saved:</span><span class="space"> </span><span class="var">isSaved</span><span class="punctuation">,</span><br><span class="space">      </span><span class="punctuation">logo:</span><span class="space"> </span><span class="keyword">await</span><span class="space"> </span><span class="special">getDownloadUrl(</span><span class="number">school</span><span class="punctuation">.</span><span class="special">data(</span><span class="special">)</span><span class="punctuation">.</span><span class="var">logo</span><span class="special">)</span><span class="punctuation">,</span><br><span class="space">      </span><span class="punctuation">pictures:</span><span class="space"> </span><span class="keyword">await</span><span class="space"> </span><span class="special">getDownloadUrls(</span><span class="number">school</span><span class="punctuation">.</span><span class="special">data(</span><span class="special">)</span><span class="punctuation">.</span><span class="var">pictures</span><span class="special">)</span><span class="punctuation">,</span><br><span class="space">   </span><span class="special">}</span><br><span class="space">   </span><span class="keyword">return</span><span class="space"> </span><span class="var">data</span><br><span class="special">}</span><br><br><span class="keyword">export</span><span class="space"> </span><span class="special">{</span><span class="var">getSchools</span><span class="punctuation">,</span><span class="space"> </span><span class="var">getSchoolById</span><span class="special">}</span><br><br></pre></body></html>